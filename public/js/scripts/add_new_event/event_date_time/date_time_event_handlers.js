timely.define(["jquery_timely","ai1ec_config","scripts/add_new_event/event_date_time/date_time_utility_functions","external_libs/jquery.calendrical_timespan","libs/utils"],function(e,t,n,r,i){var s=i.get_ajax_url(),o=function(){var t=e("#ai1ec_end option:selected").val();switch(t){case"0":n.hide_all_end_fields();break;case"1":e("#ai1ec_count_holder").css("display")==="none"&&(n.hide_all_end_fields(),e("#ai1ec_count_holder").fadeIn());break;case"2":e("#ai1ec_until_holder").css("display")==="none"&&(n.hide_all_end_fields(),e("#ai1ec_until_holder").fadeIn())}},u=function(){e("#publish").trigger("click")},a=function(t){if(!e(this).hasClass("ai1ec_active")){var n=e(".ai1ec_repeat_tabs > li > a.ai1ec_active"),r=e(n.attr("href")),i=e(e(this).attr("href"));n.removeClass("ai1ec_active"),r.hide(),e(this).addClass("ai1ec_active"),i.append(e("#ai1ec_repeat_tab_append")),e("#ai1ec_ending_box").show(),i.show()}return!1},f=function(i){var o=e(this),u="",a=e(e(".ai1ec_active").attr("href")),f=a.attr("title");switch(f){case"daily":u+="FREQ=DAILY;";var l=e("#ai1ec_daily_count").val();l>1&&(u+="INTERVAL="+l+";");break;case"weekly":u+="FREQ=WEEKLY;";var c=e("#ai1ec_weekly_count").val();c>1&&(u+="INTERVAL="+c+";");var h=e('input[name="ai1ec_weekly_date_select"]:first').val(),p=e('#ai1ec_weekly_date_select > li:first > input[type="hidden"]:first').val();h.length>0&&(u+="WKST="+p+";BYday="+h+";");break;case"monthly":u+="FREQ=MONTHLY;";var d=e("#ai1ec_monthly_count").val(),v=e('input[name="ai1ec_monthly_type"]:checked').val();d>1&&(u+="INTERVAL="+d+";");var m=e('input[name="ai1ec_montly_date_select"]:first').val();if(m.length>0&&v==="bymonthday")u+="BYMONTHDAY="+m+";";else if(v==="byday"){var g=e("#ai1ec_monthly_byday_num").val(),y=e("#ai1ec_monthly_byday_weekday").val();u+="BYday="+g+y+";"}break;case"yearly":u+="FREQ=YEARLY;";var b=e("#ai1ec_yearly_count").val();b>1&&(u+="INTERVAL="+b+";");var w=e('input[name="ai1ec_yearly_date_select"]:first').val();w.length>0&&(u+="BYMONTH="+w+";")}var E=e("#ai1ec_end").val();E==="1"&&(u+="COUNT="+e("#ai1ec_count").val()+";");if(E==="2"){var S=r.parseDate(e("#ai1ec_until-date-input").val(),t.date_format),x=new Date(r.parseDate(e("#ai1ec_start-time").val(),t.date_format)),T=S.getUTCDate(),N=S.getUTCMonth()+1,C=x.getUTCHours(),k=x.getUTCMinutes();N=N<10?"0"+N:N,T=T<10?"0"+T:T,C=C<10?"0"+C:C,k=k<10?"0"+k:k,S=S.getUTCFullYear()+""+N+T+"T235959Z",u+="UNTIL="+S+";"}var L={action:"ai1ec_rrule_to_text",rrule:u};e(this).attr("disabled",!0),e.post(s,L,function(t){t.error?e("#ai1ec_is_box_repeat").val()==="1"?n.ai1ec_repeat_form_error("#ai1ec_rrule","#ai1ec_repeat_label",t,o):n.ai1ec_repeat_form_error("#ai1ec_exrule","#ai1ec_exclude_label",t,o):e("#ai1ec_is_box_repeat").val()==="1"?n.ai1ec_repeat_form_success("#ai1ec_rrule","#ai1ec_repeat_label","#ai1ec_repeat_text > a",u,o,t):n.ai1ec_repeat_form_success("#ai1ec_exrule","#ai1ec_exclude_label","#ai1ec_exclude_text > a",u,o,t)},"json")},l=function(t){return e("#ai1ec_is_box_repeat").val()==="1"?n.ai1ec_click_on_modal_cancel("#ai1ec_repeat_text > a","#ai1ec_repeat","#ai1ec_repeat_label"):n.ai1ec_click_on_modal_cancel("#ai1ec_exclude_text > a","#ai1ec_exclude","#ai1ec_exclude_label"),e.unblockUI(),!1},c=function(t){e("#ai1c_repeat_monthly_bymonthday").toggle(),e("#ai1c_repeat_monthly_byday").toggle()},h=function(t){var n=e(t.target);n.hasClass("ai1ec_selected")?n.removeClass("ai1ec_selected"):n.addClass("ai1ec_selected");var r=[],i=n.closest("ul");e("li",i).each(function(t,n){if(e(n).hasClass("ai1ec_selected")){var i=e(n).children('input[type="hidden"]:first').val();r.push(i)}}),i.next().val(r.join())},p=function(){n.ai1ec_click_on_ics_rule_text("#ai1ec_repeat_text > a","#ai1ec_repeat","#ai1ec_repeat_label",{action:"ai1ec_get_repeat_box",repeat:1,post_id:e("#post_ID").val()},n.ai1ec_apply_js_on_repeat_block),n.ai1ec_click_on_ics_rule_text("#ai1ec_exclude_text > a","#ai1ec_exclude","#ai1ec_exclude_label",{action:"ai1ec_get_repeat_box",repeat:0,post_id:e("#post_ID").val()},n.ai1ec_apply_js_on_repeat_block),n.ai1ec_click_on_checkbox("#ai1ec_repeat","#ai1ec_repeat_text > a","#ai1ec_repeat_label",{action:"ai1ec_get_repeat_box",repeat:1,post_id:e("#post_ID").val()},n.ai1ec_apply_js_on_repeat_block),n.ai1ec_click_on_checkbox("#ai1ec_exclude","#ai1ec_exclude_text > a","#ai1ec_exclude_label",{action:"ai1ec_get_repeat_box",repeat:0,post_id:e("#post_ID").val()},n.ai1ec_apply_js_on_repeat_block)},d=function(t){var n=e(this).data("state")===undefined?!1:e(this).data("state");return e("#widgetCalendar").stop().animate({height:n?0:e("#widgetCalendar div.datepicker").get(0).offsetHeight},500),e(this).data("state",!n),!1};return{show_end_fields:o,trigger_publish:u,handle_click_on_tab_modal:a,handle_click_on_apply_button:f,handle_click_on_cancel_modal:l,handle_checkbox_monthly_tab_modal:c,execute_pseudo_handlers:p,handle_animation_of_calendar_widget:d,handle_click_on_day_month_in_modal:h}});