timely.define(["jquery_timely","domReady","scripts/calendar_feeds/ics/ics_event_handlers","libs/select2_multiselect_helper","libs/tags_select","libs/utils","ai1ec_config","libs/gmaps","external_libs/jquery_cookie","external_libs/bootstrap/tab","external_libs/bootstrap/alert","external_libs/bootstrap/modal","external_libs/bootstrap/button","external_libs/bootstrap/collapse"],function(e,t,n,r,i,s,o,u){var a=function(){var t=e(this.hash);r.refresh(t),i.refresh(t)},f=function(t){var n=e(this).attr("href");e.cookie("feeds_active_tab",n),"#suggested"===n&&h()},l=function(){var t=e("#ai1ec-feeds-after"),s=e(".ai1ec_submit_wrapper"),l=e(".ai1ec_file_upload_tags_categories");r.init(t),i.init(t),r.init(s),i.init(s),r.init(l),i.init(l),e("ul.ai1ec-nav a").on("click",f),e("ul.ai1ec-nav a").on("shown",a),e('select[name="cron_freq"]').on("change",function(){e.ajax({url:ajaxurl,type:"POST",data:{action:"ai1ec_feeds_page_post",cron_freq:this.value}})}),e("#ai1ec-ics-modal").on("click",".remove, .keep",n.submit_delete_modal),e(document).on("click","#ai1ec_add_new_ics",n.add_new_feed).on("click",".ai1ec_delete_ics",n.open_delete_modal).on("click",".ai1ec_update_ics",n.update_feed).on("click",".ai1ec_edit_ics",n.edit_feed).on("click","#ai1ec_cancel_ics",n.edit_cancel).on("click",".ai1ec-panel-heading > a",n.edit_cancel).on("blur","#ai1ec_feed_url",n.feed_url_change),e(document).on("click",".ai1ec-suggested-import-event",function(){var t=e(this),n=t.closest(".ai1ec-suggested-event-import"),r=t.closest(".ai1ec-infowindow, tr").attr("data-event-id");return e("a.ai1ec-suggested-processing",n).removeClass("ai1ec-hidden"),t.addClass("ai1ec-hidden"),e.ajax({url:o.ajax_url,type:"POST",data:{action:"ai1ec_import_suggested_event",ai1ec_event_id:r},success:function(t){e("a.ai1ec-suggested-processing",n).addClass("ai1ec-hidden"),e("a.ai1ec-suggested-remove-event",n).removeClass("ai1ec-hidden")}}),!1}),e(document).on("click",".ai1ec-suggested-remove-event",function(){var t=e(this),n=t.closest(".ai1ec-suggested-event-import"),r=t.closest(".ai1ec-infowindow, tr").attr("data-event-id");return e("a.ai1ec-suggested-processing",n).removeClass("ai1ec-hidden"),t.addClass("ai1ec-hidden"),e.ajax({url:o.ajax_url,type:"POST",data:{action:"ai1ec_remove_suggested_event",ai1ec_event_id:r},success:function(t){e("a.ai1ec-suggested-processing",n).addClass("ai1ec-hidden"),e("a.ai1ec-suggested-import-event",n).removeClass("ai1ec-hidden")}}),!1}),e(document).on("click",".ai1ec-suggested-view-selector > a",function(){var t=e(this),n=t.parent(),r=t.attr("data-ai1ec-view");return e("#suggested").removeClass(function(e,t){return(t.match(/(^|\s)ai1ec-feeds-\S+/g)||[]).join(" ")}).addClass("ai1ec-feeds-"+r),n.find("a.ai1ec-active").removeClass("ai1ec-active"),t.addClass("ai1ec-active").blur(),e("[data-ai1ec-show]").hide().filter('[data-ai1ec-show~="'+r+'"]').show(),u(c),!1}),e(document).on("click","a.ai1ec-suggested-title",function(){var t=e(this),n=t.closest("tr"),r=e.parseJSON(n.attr("data-event"));if(n.hasClass("ai1ec-suggested-hover"))e("#ai1ec_events_map_canvas").removeClass("goes-left"),n.removeClass("ai1ec-suggested-hover");else{e(".ai1ec-suggested-hover").removeClass("ai1ec-suggested-hover"),n.addClass("ai1ec-suggested-hover"),e("#ai1ec_events_map_canvas").addClass("goes-left");var i=e("#ai1ec_events_extra_details").html("");r.image&&i.append(e("<img />",{src:r.image,alt:""})),i.append(e('<div class="ai1ec-extra-title"></div>').text(r.title)).append(e('<div class="ai1ec-extra-date"></div>').text(r.dtstart+" ("+r.timezone+")")).append(e('<div class="ai1ec-extra-venue"></div>').text(r.venue_name)).append(e('<div class="ai1ec-extra-location"></div>').text(r.location)).append(e('<div class="ai1ec-extra-description"></div>').text(r.description))}return t.blur(),!1})},c=function(){var t=e("tr.ai1ec-suggested-event"),n=[],r=new google.maps.LatLngBounds;map_options={mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,zoomControl:!0,scaleControl:!0},buttons=e(".ai1ec-suggested-events-actions-template").html(),events_map=new google.maps.Map(e("#ai1ec_events_map_canvas").get(0),map_options),infowindow=new google.maps.InfoWindow({maxWidth:260}),create_info=function(e){var t='<div class="ai1ec-infowindow" data-event-id="'+e.id+'"><div class="ai1ec-infowindow-title"><b>'+e.title+"</b></div>"+e.dtstart.substr(0,10)+" @ "+e.venue_name+"<br>"+buttons+"</div>";infowindow.setContent(t)},t.each(function(){var t=e(this),i=e.parseJSON(t.attr("data-event"));if(!i||!i.latitude||!i.longitude)return;var s=new google.maps.Marker({map:events_map,title:i.title,position:new google.maps.LatLng(i.latitude,i.longitude)});s.event_id=i.id,s.addListener("click",function(){create_info(i),infowindow.open(events_map,this)}),s.addListener("mouseover",function(){e('tr[data-event-id="'+this.event_id+'"]').addClass("ai1ec-suggested-hover")}),s.addListener("mouseout",function(){e('tr[data-event-id="'+this.event_id+'"]').removeClass("ai1ec-suggested-hover")}),r.extend(s.getPosition()),n.push(s)}),events_map.fitBounds(r)},h=function(){setTimeout(function(){u(c)},0)},p=function(){t(function(){s.activate_saved_tab_on_page_load(e.cookie("feeds_active_tab")),l(),"#suggested"===e.cookie("feeds_active_tab")&&h()})};return{start:p}});