timely.define(["jquery_timely","scripts/calendar_feeds/ics/ics_ajax_handlers","libs/utils","ai1ec_config"],function(e,t,n,r){var i=n.get_ajax_url(),s=function(s){s.preventDefault();var o=e(this),u=e("#ai1ec_feed_url"),a=u.val().replace("webcal://","http://"),f=!1,l;e(".ai1ec-feed-url, #ai1ec_feed_url").css("border-color","#DFDFDF"),e("#ai1ec-feed-error").remove(),e(".ai1ec-feed-url").each(function(){this.value===a&&(e(this).css("border-color","#FF0000"),f=!0,l=r.duplicate_feed_message)}),n.isUrl(a)||(f=!0,l=r.invalid_url_message);if(f)u.addClass("input-error").focus().before('<div class="error" id="ai1ec-feed-error"><p>'+l+"</p></div>");else{o.prop("disabled",!0);var c=e("#ai1ec_comments_enabled").is(":checked")?1:0,h=e("#ai1ec_map_display_enabled").is(":checked")?1:0,p=e("#ai1ec_add_tag_categories").is(":checked")?1:0,d={action:"ai1ec_add_ics",feed_url:a,feed_category:e("#ai1ec_feed_category").val(),feed_tags:e("#ai1ec_feed_tags").val(),comments_enabled:c,map_display_enabled:h,keep_tags_categories:p};e.post(i,d,t.handle_add_new_ics,"json")}},o=function(n){n.preventDefault(),e("#ai1ec-ics-modal").modal("hide");var r=e(this).hasClass("remove")?!0:!1,s=e(this).data("el"),o=e(s),u=o.closest(".ai1ec-feed-container"),a=e(".ai1ec_feed_id",u).val();e(".ajax-loading",u).css("visibility","visible");var f={action:"ai1ec_delete_ics",ics_id:a,remove_events:r};e.post(i,f,t.handle_delete_ics,"json")},u=function(t){t.preventDefault(),e("#ai1ec-ics-modal a.btn").data("el",this),e("#ai1ec-ics-modal").modal({show:!0,backdrop:!0})},a=function(n){n.preventDefault();var r=e(this);r.prop("disabled",!0);var s=r.closest(".ai1ec-feed-container"),o=e(".ai1ec_feed_id",s).val();e(".ajax-loading",s).css("visibility","visible");var u={action:"ai1ec_update_ics",ics_id:o};e.post(i,u,t.handle_update_ics,"json")};return{add_new_ics_event_handler:s,delete_ics_modal_handler:o,handle_open_modal:u,update_ics_handler:a}});